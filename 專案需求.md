# 語音轉錄專案需求

## 專案概述
基於 `MediaTek-Research/Breeze-ASR-25` 模型的智能語音轉錄工具，專門針對台灣口音優化，具備自動硬體偵測、分段處理、續轉功能和即時進度顯示。

## 核心功能需求

### 1. 智能硬體偵測與優化
- **自動偵測硬體**: 自動識別 Apple Silicon、NVIDIA GPU、CPU 等硬體配置
- **動態記憶體管理**: 依據可用記憶體自動調整分段大小和批次處理參數
- **硬體加速**: 自動選擇最佳加速方式 (MPS/GPU/CPU)
- **效能監控**: 即時監控記憶體使用率和處理速度

### 2. 音訊檔案處理
- **自動偵測**: 自動偵測 `source.aac` 或 `source.mp3` 檔案
- **智能預處理**: 
  - 格式轉換: AAC/MP3 → WAV (16kHz, 單聲道, 16-bit PCM)
  - 音量增強: 動態調整音量 (15-30dB) 依據音訊品質
  - 音頻濾波: 高通濾波 (80Hz) + 低通濾波 (8000Hz)
- **臨時檔案管理**: 所有臨時檔案存放在 `temp/` 目錄，自動清理

### 3. 智能分段處理
- **動態分段**: 依據硬體效能和記憶體自動調整分段大小 (60-300 秒)
- **重疊處理**: 動態重疊 (3-10 秒) 避免語音被切斷
- **即時保存**: 每段轉錄完成後立即寫入結果檔案
- **進度顯示**: 即時顯示轉錄進度百分比和預估完成時間

### 4. 續轉功能
- **檔案識別**: 比較音訊檔案大小和長度
- **內容驗證**: 檢查現有轉錄結果是否為有效內容
- **智能續接**: 自動從上次中斷處繼續轉錄
- **避免重複**: 防止重複處理相同音訊檔案

### 5. 模型優化
- **自動參數調整**: 依據硬體效能自動調整模型參數
- **精度優化**: 自動選擇 float16/float32 精度
- **批次處理**: 動態調整 batch_size 依據記憶體大小
- **時間戳記**: 自動生成精確的時間戳記

## 技術規格

### 系統需求
- **作業系統**: macOS (Apple Silicon 優先), Windows, Linux
- **Python**: 3.9+
- **主要套件**: transformers, torch, ffmpeg, psutil
- **記憶體**: 自動偵測，建議 8GB+ (處理長音訊檔案)

### 檔案結構
```
專案根目錄/
├── transcribe.py          # 主程式
├── source.aac            # 輸入音訊檔案
├── temp/                 # 臨時檔案目錄
│   ├── source_temp.wav
│   ├── source_optimized.wav
│   └── segment_*.wav
└── 轉錄結果/             # 輸出目錄
    └── result-source-YYYYMMDD_HHMMSS.txt
```

### 輸出格式
```
語音轉錄結果
檔案大小: 45.4 MB
音訊長度: 25.3 分鐘
轉錄時間: 2024-09-03 22:30:15
硬體配置: Apple Silicon M4 Pro (24GB)
分段大小: 180 秒 (自動調整)
記憶體使用率: 85%
--- 分段轉錄結果 ---

[00:00:00 - 00:03:00] 第一段轉錄內容...
[00:03:00 - 00:06:00] 第二段轉錄內容...
...
```

## 使用方式

### 簡化使用
```bash
python3 transcribe.py
```
程式會自動偵測硬體配置並優化參數，無需手動設定。

## 進階功能需求

### 6. 智能音訊分析
- **音量偵測**: 自動分析音訊音量並動態調整增強參數
- **噪音過濾**: 自動偵測並過濾背景噪音
- **語音品質評估**: 評估音訊品質並提供改善建議
- **多語言偵測**: 自動偵測語音語言並選擇最佳模型

### 7. 批次處理能力
- **多檔案處理**: 支援同時處理多個音訊檔案
- **佇列管理**: 智能排程處理順序
- **進度追蹤**: 批次處理進度顯示
- **結果整合**: 自動整合多個檔案的轉錄結果

### 8. 轉錄品質優化
- **後處理校正**: 自動校正常見轉錄錯誤
- **標點符號**: 智能添加標點符號
- **分段優化**: 依據語音內容智能分段
- **時間戳記精確度**: 提高時間戳記的精確度

### 9. 使用者體驗
- **即時預覽**: 轉錄過程中即時顯示結果
- **進度預估**: 準確預估剩餘處理時間
- **錯誤恢復**: 自動恢復中斷的轉錄任務
- **結果匯出**: 支援多種格式匯出 (TXT, SRT, VTT)

### 10. 效能監控與優化
- **硬體監控**: 即時監控 CPU、記憶體、GPU 使用率
- **效能分析**: 分析處理速度並提供優化建議
- **資源管理**: 智能管理系統資源避免過載
- **快取機制**: 快取處理結果減少重複計算

## 問題解決

### 常見問題
1. **轉錄結果只有驚嘆號**: 動態音量增強和音訊品質分析
2. **記憶體不足**: 智能分段和動態記憶體管理
3. **轉錄速度慢**: 硬體加速和參數自動優化
4. **程式卡住**: 進度監控和超時警告機制

### 錯誤處理
- 自動清理臨時檔案
- 記憶體使用監控和警告
- 轉錄失敗自動重試機制
- 詳細的錯誤訊息和日誌記錄
- 硬體故障自動降級處理

## 版本歷史
- **v1.0**: 基本轉錄功能
- **v1.1**: 加入分段處理
- **v1.2**: 實作續轉功能
- **v1.3**: 優化音訊預處理
- **v1.4**: 改善臨時檔案管理
- **v1.5**: 增強音量處理 (25dB)
- **v2.0**: 智能硬體偵測和自動參數優化
- **v2.1**: 動態記憶體管理和效能監控
- **v2.2**: 批次處理和多檔案支援
- **v2.3**: 轉錄品質優化和後處理

---

*最後更新: 2024-09-03*
